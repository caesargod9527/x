/******************************************
 * @name 𝐓𝐢𝐝𝐚𝐥
 * @description 解锁 HIFI 音质
 * @channel https://t.me/yqc_123
 * @feedback https://t.me/yqc_777
 * @version 1.1.0
******************************************
^https?:\/\/api\.tidal\.com\/v1\/users\/\d+\/subscription.+ url script-response-body https://raw.githubusercontent.com/yqc007/QuantumultX/master/TIDALHiFiPlusCrack.js
^https?:\/\/api\.tidal\.com\/v1\/tracks/\d+\/playbackinfo url script-analyze-echo-response https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/tidal.js
hostname = api.tidal.com
******************************************/
const $ = new Env('𝐓𝐢𝐝𝐚𝐥')
var _0xodI='jsjiami.com.v7';const _0x2f7eae=_0x207e;if(function(_0x30bc18,_0x28267b,_0x4a7e46,_0x5289e7,_0x59cf15,_0x3c8ddc,_0x483e94){return _0x30bc18=_0x30bc18>>0x7,_0x3c8ddc='hs',_0x483e94='hs',function(_0x4d4556,_0x2b1de5,_0x16ce5f,_0x276eeb,_0x41e849){const _0x59ba44=_0x207e;_0x276eeb='tfi',_0x3c8ddc=_0x276eeb+_0x3c8ddc,_0x41e849='up',_0x483e94+=_0x41e849,_0x3c8ddc=_0x16ce5f(_0x3c8ddc),_0x483e94=_0x16ce5f(_0x483e94),_0x16ce5f=0x0;const _0x496297=_0x4d4556();while(!![]&&--_0x5289e7+_0x2b1de5){try{_0x276eeb=parseInt(_0x59ba44(0xaf,'DEgm'))/0x1*(parseInt(_0x59ba44(0xb2,'i5FK'))/0x2)+-parseInt(_0x59ba44(0x87,'X1nV'))/0x3+-parseInt(_0x59ba44(0x8d,'X**E'))/0x4*(parseInt(_0x59ba44(0xc1,'fbv1'))/0x5)+parseInt(_0x59ba44(0xb9,'fbv1'))/0x6*(-parseInt(_0x59ba44(0x97,'hSWK'))/0x7)+parseInt(_0x59ba44(0x89,'o4hW'))/0x8+parseInt(_0x59ba44(0x91,'NV09'))/0x9*(parseInt(_0x59ba44(0x90,'FEfI'))/0xa)+parseInt(_0x59ba44(0xa6,'H09)'))/0xb;}catch(_0x4fcb47){_0x276eeb=_0x16ce5f;}finally{_0x41e849=_0x496297[_0x3c8ddc]();if(_0x30bc18<=_0x5289e7)_0x16ce5f?_0x59cf15?_0x276eeb=_0x41e849:_0x59cf15=_0x41e849:_0x16ce5f=_0x41e849;else{if(_0x16ce5f==_0x59cf15['replace'](/[qrnIwgEDNRUYGyVMxKF=]/g,'')){if(_0x276eeb===_0x2b1de5){_0x496297['un'+_0x3c8ddc](_0x41e849);break;}_0x496297[_0x483e94](_0x41e849);}}}}}(_0x4a7e46,_0x28267b,function(_0x50169f,_0x1c00bb,_0x2ca487,_0x2f2a00,_0x34d78e,_0x4426f6,_0x30cbdb){return _0x1c00bb='\x73\x70\x6c\x69\x74',_0x50169f=arguments[0x0],_0x50169f=_0x50169f[_0x1c00bb](''),_0x2ca487='\x72\x65\x76\x65\x72\x73\x65',_0x50169f=_0x50169f[_0x2ca487]('\x76'),_0x2f2a00='\x6a\x6f\x69\x6e',(0x15d091,_0x50169f[_0x2f2a00](''));});}(0x6000,0x44ef8,_0x3eeb,0xc2),_0x3eeb){}$['hasReqBody']=()=>typeof $request!==_0x2f7eae(0x98,'x%cV'),$['response']={'body':$[_0x2f7eae(0x9f,'3uTW')]()?'{}':$response[_0x2f7eae(0xba,'*iq1')]};const server='https://free.yuhengy17.me',interface_id=_0x2f7eae(0xb4,'aZwI'),defaultReq=()=>new Promise((_0x2ab00c,_0x253df2)=>{const _0x5fc25=_0x2f7eae,_0x552fae={'xmtvw':function(_0x202b89,_0x259162){return _0x202b89(_0x259162);}};$[_0x5fc25(0xc3,'X@3&')]({'url':$request['url'],'headers':$request[_0x5fc25(0xa8,'&Fn2')],'body':$request[_0x5fc25(0xb1,'i5FK')]},(_0x2acff7,_0x46f31d,_0x1d6993)=>{_0x2acff7?_0x253df2(_0x2acff7):_0x552fae['xmtvw'](_0x2ab00c,_0x46f31d);});}),httpRequest=()=>new Promise((_0x434fc5,_0x11e1dc)=>{const _0x2c02c1=_0x2f7eae,_0x53e884={'QkeRX':function(_0x50f3bc,_0x3585e8){return _0x50f3bc(_0x3585e8);},'ztRir':_0x2c02c1(0x8a,'aZwI'),'tapJS':'Content-Encoding','xRKTc':'content-encoding','QFJxX':_0x2c02c1(0xa0,'&Fn2'),'JgquS':_0x2c02c1(0x99,'o4hW'),'RqwaE':'content-length','jACIi':function(_0x3dd9bb){return _0x3dd9bb();}},_0xe26faf={'url':server+'/api/'+interface_id+_0x2c02c1(0xaa,'X**E'),'headers':{'Content-Type':_0x2c02c1(0x8e,'x%cV')},'body':JSON[_0x2c02c1(0x85,'H09)')]({'url':$request[_0x2c02c1(0xa9,'*sVL')],'yuheng':$[_0x2c02c1(0xae,'fbv1')]()?$request:$response['body']})};$[_0x2c02c1(0x84,'aZwI')](_0xe26faf,async(_0x2edc76,_0x3de877,_0x3801ce)=>{const _0x1e517d=_0x2c02c1;if(_0x2edc76)return _0x53e884['QkeRX'](_0x11e1dc,_0x2edc76);$[_0x1e517d(0x93,'JtG8')]()&&($[_0x1e517d(0x9e,'Bc#1')]=await defaultReq(),$[_0x1e517d(0xbb,'Q*[g')][_0x1e517d(0x95,'5i81')]=_0x53e884['ztRir'],delete $['response'][_0x1e517d(0xb5,'NZ0@')][_0x53e884[_0x1e517d(0x9a,'$Ti]')]],delete $[_0x1e517d(0xb3,'!Wiu')][_0x1e517d(0xbe,'Q*[g')][_0x53e884[_0x1e517d(0x9b,'gy[*')]],delete $[_0x1e517d(0xc2,'lTD$')][_0x1e517d(0xb0,'JtG8')][_0x53e884[_0x1e517d(0xc4,'$Ti]')]],delete $[_0x1e517d(0x96,'GA#$')][_0x1e517d(0xc5,'%*j9')][_0x53e884[_0x1e517d(0xc0,'9!G%')]],delete $['response'][_0x1e517d(0xa1,'O8#U')][_0x1e517d(0xbf,'DEgm')],delete $[_0x1e517d(0xa2,'rZpM')][_0x1e517d(0x8b,'E%LZ')][_0x53e884[_0x1e517d(0x8f,'RApi')]]),$['response'][_0x1e517d(0xb8,'2)nd')]=_0x3801ce,_0x53e884[_0x1e517d(0x9c,'$Ti]')](_0x434fc5);});}),done=()=>{const _0x534c50=_0x2f7eae;$['hasReqBody']()?$['isQuanX']()?$['done']({'status':$[_0x534c50(0xa5,'Y7dn')][_0x534c50(0xac,'gy[*')],'headers':$[_0x534c50(0xa4,'&Fn2')][_0x534c50(0xb7,'lTD$')],'body':$[_0x534c50(0xb6,'NZ0@')][_0x534c50(0x86,'H09)')]}):$['done']({'response':{'status':0xc8,'headers':$[_0x534c50(0xad,'hSWK')][_0x534c50(0x94,'X1nV')],'body':$[_0x534c50(0xa7,'i5FK')][_0x534c50(0xb8,'2)nd')]}}):$[_0x534c50(0xbc,'9!G%')]({'body':$[_0x534c50(0x96,'GA#$')]['body']});};function _0x207e(_0x279e61,_0x97c23d){const _0x3eeb48=_0x3eeb();return _0x207e=function(_0x207e9d,_0x14f977){_0x207e9d=_0x207e9d-0x83;let _0x40aa07=_0x3eeb48[_0x207e9d];if(_0x207e['yDRssa']===undefined){var _0x35b669=function(_0x2a2c79){const _0x30d2d0='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x401099='',_0x45c08c='';for(let _0x195920=0x0,_0x5dc367,_0x3f33ac,_0x5e2e1a=0x0;_0x3f33ac=_0x2a2c79['charAt'](_0x5e2e1a++);~_0x3f33ac&&(_0x5dc367=_0x195920%0x4?_0x5dc367*0x40+_0x3f33ac:_0x3f33ac,_0x195920++%0x4)?_0x401099+=String['fromCharCode'](0xff&_0x5dc367>>(-0x2*_0x195920&0x6)):0x0){_0x3f33ac=_0x30d2d0['indexOf'](_0x3f33ac);}for(let _0x18822b=0x0,_0x3f88a2=_0x401099['length'];_0x18822b<_0x3f88a2;_0x18822b++){_0x45c08c+='%'+('00'+_0x401099['charCodeAt'](_0x18822b)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x45c08c);};const _0x965529=function(_0x589494,_0xe6fb14){let _0x41ee84=[],_0x295999=0x0,_0x48e400,_0x55bfba='';_0x589494=_0x35b669(_0x589494);let _0x58c3a7;for(_0x58c3a7=0x0;_0x58c3a7<0x100;_0x58c3a7++){_0x41ee84[_0x58c3a7]=_0x58c3a7;}for(_0x58c3a7=0x0;_0x58c3a7<0x100;_0x58c3a7++){_0x295999=(_0x295999+_0x41ee84[_0x58c3a7]+_0xe6fb14['charCodeAt'](_0x58c3a7%_0xe6fb14['length']))%0x100,_0x48e400=_0x41ee84[_0x58c3a7],_0x41ee84[_0x58c3a7]=_0x41ee84[_0x295999],_0x41ee84[_0x295999]=_0x48e400;}_0x58c3a7=0x0,_0x295999=0x0;for(let _0xb5a755=0x0;_0xb5a755<_0x589494['length'];_0xb5a755++){_0x58c3a7=(_0x58c3a7+0x1)%0x100,_0x295999=(_0x295999+_0x41ee84[_0x58c3a7])%0x100,_0x48e400=_0x41ee84[_0x58c3a7],_0x41ee84[_0x58c3a7]=_0x41ee84[_0x295999],_0x41ee84[_0x295999]=_0x48e400,_0x55bfba+=String['fromCharCode'](_0x589494['charCodeAt'](_0xb5a755)^_0x41ee84[(_0x41ee84[_0x58c3a7]+_0x41ee84[_0x295999])%0x100]);}return _0x55bfba;};_0x207e['fnGCEo']=_0x965529,_0x279e61=arguments,_0x207e['yDRssa']=!![];}const _0x350fbc=_0x3eeb48[0x0],_0x269e2a=_0x207e9d+_0x350fbc,_0x26bca6=_0x279e61[_0x269e2a];return!_0x26bca6?(_0x207e['zmkHQP']===undefined&&(_0x207e['zmkHQP']=!![]),_0x40aa07=_0x207e['fnGCEo'](_0x40aa07,_0x14f977),_0x279e61[_0x269e2a]=_0x40aa07):_0x40aa07=_0x26bca6,_0x40aa07;},_0x207e(_0x279e61,_0x97c23d);}function _0x3eeb(){const _0x5ec884=(function(){return[_0xodI,'rIyjMEsUNxjGiFaEDmnVi.cRMMoqwmY.v7EgFwKI==','W4ldGuRcRdHtua','W5JdGvJcUdjpubG','bSoBlCoJWOy1sG','WPxdJ112','evNcSCoyWQNdTthcIGC','WROUWRnR','zCkMEJpcGd4lgG','ASobWPNdMa','W6CNyrZcOW','F8kMAcFcIIil','ASkvjSoyW6lcN8ogWOyDmmoPlfBcHq','rmojWOBdImky','hrpdMCobWOZdUt0','hmoBp8o3WOWPsSko','zCoBWOax','W6dcKCoRA10','WPSpm293WRvM','E8kSBGBcNsi','WO9HASo4','axTDiHPItCkxiG','egblmG','WPaVWRrTWQGFtmksW7ldMHRcIW'].concat((function(){return['W78iWRNcKgFdHCodxmoxW5HcEHW','WR7dU8kyW6zlWRiQWQzZWRJdLNxcTq','WRDAtCoCW601obJcVttdISohW4FcTxS','WOZdQCk+W59QW7hdUW','fZZdVSo4oSk5W6C','W7VdRslcGcGgW6K7fCkZWRTgFG','bCoNW4L3q2yltMPcFI5tW6v5WOBdM2KSWRamW41crCkJWROwy1io','cSoXduxcKa','xW7dKSktW7RcJSoLtq','W7jzuConeSkRWO0pEH1+jCkW','qmkSemooW4vtW5id','ca42W7RdMmkyWO5lF30','W4b7W6uWW7Xvvq','aCoOf8oRW75u','W5uJcSk7WOBcHda+','wSk2W75bECouWOhdJmk3cq','eCo5W51+tgWex2C','W7VcUSooWRSjW6j/WPmDWO7dGMdcI8otF0mq','W4xcTSorwvy','p8knjSoYW48','W5VcLSoIwMW','wSkiWP7dJXy','u8k5W5G+qCo/W5uu','gmoyWQmDgmkXwqLCWQK'].concat((function(){return['W63dGw9cW6ZdMLWla8kPWRvkWO/cT8ojcHG','W7/dISo4l3G4W58','cx4hWO4IeSkbnq','W7LyuCods8ojW50Vyca','W4VdLN1CW7ddKKOC','WRbeW4JcIehcJepdLG','qdWFFeqWfSkckCokqSkzW7K','W4FdGeFcKexcNmoUW48','W5hdLM9iW7RdJKO','yfD2','W6xcQxFdGM5yWQ8l','g8oiFmkvWRpdG8okW7i1hmosdG','nmkRdmosW5NdJG','eCoIWR8jD8oPWPRdOG','qahdSSo+WR7dOcxcGraA','gSk1gCozW6VcTCod','caOKW4ZdMmkBWR8','W5FdILdcMq','WOFcLWddMr7dGmoLW7pcMuLLna','W7tdMmkUxmoaagVcRG','WOTNFCoTWQ4'];}()));}()));}());_0x3eeb=function(){return _0x5ec884;};return _0x3eeb();};!(async()=>{const _0x19fdb0=_0x2f7eae,_0x33d10d={'NsHZT':function(_0x4e9a50){return _0x4e9a50();}};await _0x33d10d[_0x19fdb0(0x9d,'kifF')](httpRequest);})()[_0x2f7eae(0xbd,'FM1K')]($[_0x2f7eae(0x83,'Q*[g')])['finally'](done);var version_ = 'jsjiami.com.v7';
// prettier-ignore
function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,a)=>{s.call(this,t,(t,s,r)=>{t?a(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const a=this.getdata(t);if(a)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,a)=>e(a))})}runScript(t,e){return new Promise(s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[i,o]=a.split("@"),n={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":i,Accept:"*/*"},timeout:r};this.post(n,(t,e,a)=>s(a))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e);if(!s&&!a)return{};{const a=s?t:e;try{return JSON.parse(this.fs.readFileSync(a))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):a?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const a=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of a)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[a+1])>>0==+e[a+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,a,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,a,r]=/^@(.*?)\.(.*?)$/.exec(e),i=this.getval(a),o=a?"null"===i?null:i||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),a)}catch(e){const i={};this.lodash_set(i,r,t),s=this.setval(JSON.stringify(i),a)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:a,statusCode:r,headers:i,rawBody:o}=t,n=s.decode(o,this.encoding);e(null,{status:a,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:a,response:r}=t;e(a,r,r&&s.decode(r.rawBody,this.encoding))})}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let a=require("iconv-lite");this.initGotEnv(t);const{url:r,...i}=t;this.got[s](r,i).then(t=>{const{statusCode:s,statusCode:r,headers:i,rawBody:o}=t,n=a.decode(o,this.encoding);e(null,{status:s,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:s,response:r}=t;e(s,r,r&&a.decode(r.rawBody,this.encoding))})}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}queryStr(t){let e="";for(const s in t){let a=t[s];null!=a&&""!==a&&("object"==typeof a&&(a=JSON.stringify(a)),e+=`${s}=${a}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",a="",r){const i=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let e=t.url||t.openUrl||t["open-url"];return{url:e}}case"Loon":{let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}case"Quantumult X":{let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl,a=t["update-pasteboard"]||t.updatePasteboard;return{"open-url":e,"media-url":s,"update-pasteboard":a}}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,a,i(r));break;case"Quantumult X":$notify(e,s,a,i(r));break;case"Node.js":}if(!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),a&&t.push(a),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t.stack)}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}
